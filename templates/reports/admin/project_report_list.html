{% extends 'base.html' %}
{% load static %}

{% block title %}Project Reports - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="fas fa-file-alt"></i> Project Reports</h2>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'reports:project_report_create' %}" class="btn btn-success">
                <i class="fas fa-plus"></i> Assign / Create Report
            </a>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <form method="get" class="d-flex">
                <select class="form-select me-2" name="status" onchange="this.form.submit()">
                    <option value="">-- All statuses --</option>
                    <option value="pending"{% if request.GET.status == 'pending' %} selected{% endif %}>Pending</option>
                    <option value="submitted"{% if request.GET.status == 'submitted' %} selected{% endif %}>Submitted</option>
                    <option value="graded"{% if request.GET.status == 'graded' %} selected{% endif %}>Graded</option>
                    <option value="late"{% if request.GET.status == 'late' %} selected{% endif %}>Late</option>
                </select>
                <noscript><button class="btn btn-3d btn-primary">Filter</button></noscript>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            {% if reports.exists %}
                <div class="card card-3d p-3">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Title</th>
                                    <th>Due</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th class="text-end">Marks</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for report in reports %}
                                    <tr>
                                        <td>
                                            <strong>{{ report.student.user.get_full_name }}</strong><br>
                                            <small class="text-muted">{{ report.student.enrollment_number }}</small>
                                        </td>
                                        <td>{{ report.title }}</td>
                                        <td>{{ report.due_date }}</td>
                                        <td>{{ report.submission_date|date:"Y-m-d H:i" }}</td>
                                        <td>
                                            {% if report.status == 'pending' %}
                                                <span class="badge bg-secondary">Pending</span>
                                            {% elif report.status == 'submitted' %}
                                                <span class="badge bg-info">Submitted</span>
                                            {% elif report.status == 'graded' %}
                                                <span class="badge bg-success">Graded</span>
                                            {% elif report.status == 'late' %}
                                                <span class="badge bg-danger">Late</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            {% if report.marks_obtained is not None %}
                                                {{ report.marks_obtained }}/{{ report.total_marks }}
                                            {% else %}
                                                <span class="text-muted">â€”</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            <a href="{% url 'reports:project_report_grade' report.id %}" class="btn btn-3d btn-sm">
                                                <i class="fas fa-pen"></i> Grade
                                            </a>
                                            {% if report.file %}
                                                <a href="{{ report.file.url }}" class="btn btn-outline-secondary btn-sm ms-2" target="_blank">
                                                    <i class="fas fa-download"></i> Download
                                                </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> No project reports found.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
