{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Exam Management System{% endblock %}</title>

    <!-- Google Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Font Awesome (kept for legacy templates) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom theme -->
    <link href="{% static 'css/theme.css' %}" rel="stylesheet">

    <!-- Optional tilt effect library (small) -->
    <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.3/dist/vanilla-tilt.min.js"></script>

    {% block extra_css %}{% endblock %}
</head>
<body class="bg-light" style="font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;">
    <nav class="navbar navbar-expand-lg navbar-dark shadow-sm py-3" aria-label="Main navigation">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard' %}">
                <i class="bi bi-journal-text me-2 fs-4"></i>
                <span class="fw-bold">Exam System</span>
            </a>

            <!-- Offcanvas for mobile -->
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu" aria-controls="mobileMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
                <div class="offcanvas-header">
                    <h5 id="mobileMenuLabel" class="offcanvas-title">Menu</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav">
                        {% if user.is_authenticated %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'profile' %}">Profile</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
                        {% else %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Get Started</a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    {% if user.is_authenticated %}
                        <li class="nav-item me-2 d-none d-lg-block">
                            <a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a>
                        </li>
                        <li class="nav-item me-2 d-none d-lg-block">
                            <a class="nav-link" href="{% url 'profile' %}">Profile</a>
                        </li>
                        <li class="nav-item me-2 d-none d-lg-block">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#supportModal">Help</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-3d btn-sm" href="{% url 'logout' %}">Logout</a>
                        </li>
                    {% else %}
                        <li class="nav-item me-2 d-none d-lg-block">
                            <a class="btn btn-outline-light btn-sm" href="{% url 'login' %}">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-3d btn-sm" href="{% url 'register' %}">Get Started</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Toast container for messages -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1200">
        <div id="toast-container"></div>
    </div>

    <!-- Generic support modal (accessible) -->
    <div class="modal fade" id="supportModal" tabindex="-1" aria-labelledby="supportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="supportModalLabel">Help & Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>If you need help, contact the admin or check the documentation.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <main class="py-5">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="text-center py-4 mt-5">
        <small class="text-muted">&copy; 2025 Django Exam Management System. All rights reserved.</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .btn-lg {
            min-width: 140px;
            font-size: 1.25rem;
            box-shadow: 0 4px 16px rgba(80,80,200,0.08);
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .btn-lg:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 32px rgba(80,80,200,0.18);
            z-index: 2;
        }
        .gap-4 {
            gap: 2rem !important;
        }
    </style>

    <script>
        // Convert Django messages into Bootstrap toasts
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('toast-container');
            {% if messages %}
                {% for message in messages %}
                    const toastEl = document.createElement('div');
                    toastEl.className = 'toast align-items-center text-bg-{{ message.tags }} border-0';
                    toastEl.setAttribute('role','alert');
                    toastEl.setAttribute('aria-live','assertive');
                    toastEl.setAttribute('aria-atomic','true');
                    toastEl.innerHTML = `
                        <div class="d-flex">
                            <div class="toast-body">{{ message|escapejs }}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>`;
                    container.appendChild(toastEl);
                    const toast = new bootstrap.Toast(toastEl, { delay: 4000 });
                    toast.show();
                {% endfor %}
            {% endif %}

            // Initialize tilt effect for 3D cards if vanilla-tilt loaded
            if (window.VanillaTilt) {
                const tiltEls = document.querySelectorAll('.card-3d, .card-tilt, .quick-link');
                VanillaTilt.init(tiltEls, {
                    max: 8,
                    speed: 450,
                    glare: true,
                    'max-glare': 0.06,
                    scale: 1.02,
                    easing: 'cubic-bezier(.2,.9,.2,1)'
                });
            }
        });

        // Show a small client-side hint if the CSRF cookie is missing when there is a POST form
        (function() {
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            document.addEventListener('DOMContentLoaded', function() {
                const hasPostForm = document.querySelector('form[method="post"]') !== null;
                const csrfCookie = getCookie('csrftoken');
                if (hasPostForm && !csrfCookie) {
                    const alertEl = document.createElement('div');
                    alertEl.className = 'alert alert-warning';
                    alertEl.innerHTML = `<strong>Warning:</strong> It looks like your browser isn't sending cookies. If the form submission fails with a CSRF error, try enabling cookies and reload the page.`;
                    document.querySelector('main .container').insertAdjacentElement('afterbegin', alertEl);
                }
            });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>