{% extends 'base.html' %}
{% load static %}

{% block title %}Performance Report - ExamHub{% endblock %}

{% block content %}
<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --secondary: #8b5cf6;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --light-bg: #f8fafc;
    --border-light: #e2e8f0;
  }

  .performance-container {
    min-height: 100vh;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    padding: 40px 20px;
    animation: fadeInUp 0.6s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .performance-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 40px;
    animation: fadeInUp 0.6s ease-out 0.1s both;
  }

  .performance-header h1 {
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .back-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    padding: 10px 16px;
    background: rgba(99, 102, 241, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .back-button:hover {
    background: rgba(99, 102, 241, 0.2);
    transform: translateX(-4px);
    color: var(--primary-dark);
  }

  /* Overall Performance Card */
  .overall-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    border: 1px solid rgba(99, 102, 241, 0.1);
    padding: 48px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    text-align: center;
    margin-bottom: 40px;
    animation: fadeInUp 0.6s ease-out 0.15s both;
  }

  .overall-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 16px;
  }

  .overall-score {
    font-size: 72px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 16px;
  }

  .overall-message {
    font-size: 18px;
    font-weight: 700;
    color: var(--success);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .overall-subtitle {
    font-size: 14px;
    color: #64748b;
  }

  /* Metrics Grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
  }

  .metric-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    border: 1px solid rgba(99, 102, 241, 0.1);
    padding: 28px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    animation: fadeInUp 0.6s ease-out forwards;
    transition: all 0.3s ease;
  }

  .metric-card:nth-child(1) { animation-delay: 0.2s; }
  .metric-card:nth-child(2) { animation-delay: 0.25s; }
  .metric-card:nth-child(3) { animation-delay: 0.3s; }

  .metric-card:hover {
    border-color: rgba(99, 102, 241, 0.3);
    box-shadow: 0 24px 72px rgba(99, 102, 241, 0.12);
    transform: translateY(-4px);
  }

  .metric-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
  }

  .metric-score {
    font-size: 42px;
    font-weight: 800;
    margin-bottom: 16px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-score.green {
    background: linear-gradient(135deg, var(--success), #059669);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-score.warning {
    background: linear-gradient(135deg, var(--warning), #d97706);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-progress {
    width: 100%;
    height: 8px;
    background: var(--light-bg);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 12px;
  }

  .metric-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 4px;
    transition: width 0.6s ease;
  }

  .metric-weight {
    font-size: 12px;
    color: #64748b;
    font-weight: 500;
  }

  /* Detailed Performance Section */
  .details-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    border: 1px solid rgba(99, 102, 241, 0.1);
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    animation: fadeInUp 0.6s ease-out 0.35s both;
  }

  .section-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .table-container {
    overflow-x: auto;
  }

  .performance-table {
    width: 100%;
    border-collapse: collapse;
  }

  .performance-table thead {
    border-bottom: 2px solid var(--border-light);
    background: var(--light-bg);
  }

  .performance-table th {
    padding: 16px;
    text-align: left;
    font-weight: 700;
    font-size: 12px;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .performance-table td {
    padding: 16px;
    border-bottom: 1px solid var(--border-light);
    font-size: 14px;
    color: #1e293b;
  }

  .performance-table tbody tr {
    transition: all 0.3s ease;
  }

  .performance-table tbody tr:hover {
    background: rgba(99, 102, 241, 0.03);
  }

  .subject-name {
    font-weight: 600;
    color: var(--primary);
  }

  .score-cell {
    font-weight: 700;
    font-size: 16px;
  }

  .score-cell.excellent {
    color: var(--success);
  }

  .score-cell.good {
    color: var(--primary);
  }

  .score-cell.average {
    color: var(--warning);
  }

  .score-cell.below {
    color: var(--danger);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 12px;
  }

  .status-excellent {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
  }

  .status-good {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
  }

  .status-average {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
  }

  .status-below {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
  }

  .progress-bar-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .progress-bar-bg {
    flex: 1;
    height: 6px;
    background: var(--light-bg);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 3px;
  }

  .progress-percent {
    font-size: 12px;
    font-weight: 700;
    color: var(--primary);
    min-width: 40px;
    text-align: right;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
  }

  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.6;
  }

  .empty-state-text {
    font-size: 16px;
    color: #64748b;
    margin: 0;
  }

  @media (max-width: 768px) {
    .performance-container {
      padding: 20px 12px;
    }

    .performance-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .performance-header h1 {
      font-size: 24px;
    }

    .overall-card {
      padding: 32px;
    }

    .overall-score {
      font-size: 48px;
    }

    .metrics-grid {
      grid-template-columns: 1fr;
    }

    .details-card {
      padding: 24px;
    }

    .performance-table {
      font-size: 12px;
    }

    .performance-table th,
    .performance-table td {
      padding: 12px 8px;
    }

    .score-cell {
      font-size: 14px;
    }
  }
</style>

<div class="performance-container">
  <div class="performance-header">
    <h1>
      <i class="bi bi-graph-up"></i> Performance Report
    </h1>
    <a href="{% url 'exams:student:dashboard' %}" class="back-button">
      <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
  </div>

  <!-- Overall Performance Card -->
  <div class="overall-card">
    <div class="overall-title">Overall Performance</div>
    <div class="overall-score">
      {% if avg_exam_score or avg_project_score or attendance_percentage %}
        {{ overall_score|default:"0" }}%
      {% else %}
        0.0%
      {% endif %}
    </div>
    <div class="overall-message">
      <i class="bi bi-hand-thumbs-up-fill"></i> 
      {% if avg_exam_score > 75 or avg_project_score > 75 %}
        Excellent Performance
      {% elif avg_exam_score > 60 or avg_project_score > 60 %}
        Good Performance
      {% else %}
        Keep improving
      {% endif %}
    </div>
    <p class="overall-subtitle">This combines your exam scores, project work, and attendance records.</p>
  </div>

  <!-- Performance Metrics Grid -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-label">
        <i class="bi bi-pencil-square"></i> Average Exam Score
      </div>
      <div class="metric-score">{{ avg_exam_score|floatformat:0 }}%</div>
      <div class="metric-progress">
        <div class="metric-bar" style="width: {{ avg_exam_score|floatformat:0 }}%"></div>
      </div>
      <div class="metric-weight">Weight: 60%</div>
    </div>

    <div class="metric-card">
      <div class="metric-label">
        <i class="bi bi-file-earmark"></i> Project Score
      </div>
      <div class="metric-score green">{{ avg_project_score|floatformat:0 }}%</div>
      <div class="metric-progress">
        <div class="metric-bar" style="background: linear-gradient(90deg, var(--success), #059669); width: {{ avg_project_score|floatformat:0 }}%"></div>
      </div>
      <div class="metric-weight">Weight: 25%</div>
    </div>

    <div class="metric-card">
      <div class="metric-label">
        <i class="bi bi-check-circle"></i> Attendance
      </div>
      <div class="metric-score warning">{{ attendance_percentage|floatformat:1 }}%</div>
      <div class="metric-progress">
        <div class="metric-bar" style="background: linear-gradient(90deg, var(--warning), #d97706); width: {{ attendance_percentage|floatformat:0 }}%"></div>
      </div>
      <div class="metric-weight">Weight: 15%</div>
    </div>
  </div>

  <!-- Detailed Performance -->
  <div class="details-card">
    <div class="section-title">
      <i class="bi bi-book"></i> Subject-wise Performance
    </div>

    <div class="table-container">
      <table class="performance-table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Score</th>
            <th>Status</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody>
          {% for result in exam_results %}
            <tr>
              <td class="subject-name">{{ result.exam.subject.name }}</td>
              <td class="score-cell {% if result.percentage >= 80 %}excellent{% elif result.percentage >= 65 %}good{% elif result.percentage >= 50 %}average{% else %}below{% endif %}">{{ result.percentage|floatformat:0 }}%</td>
              <td>
                {% if result.percentage >= 80 %}
                  <span class="status-badge status-excellent">
                    <i class="bi bi-star-fill"></i> Excellent
                  </span>
                {% elif result.percentage >= 65 %}
                  <span class="status-badge status-good">
                    <i class="bi bi-hand-thumbs-up-fill"></i> Good
                  </span>
                {% elif result.percentage >= 50 %}
                  <span class="status-badge status-average">
                    <i class="bi bi-dash-circle"></i> Average
                  </span>
                {% else %}
                  <span class="status-badge status-below">
                    <i class="bi bi-exclamation-circle"></i> Below Average
                  </span>
                {% endif %}
              </td>
              <td>
                <div class="progress-bar-wrapper">
                  <div class="progress-bar-bg">
                    <div class="progress-bar-fill" style="width: {{ result.percentage|floatformat:0 }}%"></div>
                  </div>
                  <span class="progress-percent">{{ result.percentage|floatformat:0 }}%</span>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4">
                <div class="empty-state">
                  <div class="empty-state-icon">ðŸ“Š</div>
                  <p class="empty-state-text">No exam results available yet</p>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
